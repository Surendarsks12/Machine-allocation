<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Production Allocation</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded-xl shadow">
    <h1 class="text-3xl font-bold text-center mb-6">‚öôÔ∏è Production Allocation</h1>

    <div class="mb-4">
      <label class="font-semibold">Start Date:</label>
      <input id="startDate" type="date" class="border p-2 rounded ml-2" />
      <button onclick="allocateMachines()" class="bg-green-600 text-white px-4 py-2 rounded ml-4">üöÄ Allocate</button>
    </div>

    <div id="output" class="mt-6 text-sm"></div>
  </div>

  <script>
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbyGIjBudnlqOO7HL2zQFB4RaGlgazJT1C_ythWQmALe48K0Uwiw3SaB8p-AXiqUQTGung/exec";
    let componentData = [];

    async function fetchData() {
      try {
        const res = await fetch(SHEET_API_URL);
        componentData = await res.json();
        console.log("Fetched:", componentData);
      } catch (e) {
        alert("‚ùå Failed to fetch sheet data");
        console.error(e);
      }
    }

    function getNextDate(base, addDays) {
      const d = new Date(base);
      d.setDate(d.getDate() + addDays);
      return d.toISOString().split("T")[0];
    }

    function allocateMachines() {
      const startDateInput = document.getElementById("startDate").value;
      if (!startDateInput) {
        alert("‚ö†Ô∏è Please select a start date");
        return;
      }

      let dayOffset = 0;
      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML = `<h2 class="text-xl font-semibold mb-2">üìã Allocation Result:</h2>`;

      let tableHTML = `<table class="min-w-full border"><thead><tr class="bg-gray-200 text-left">
        <th class="border px-3 py-1">Component ID</th>
        <th class="border px-3 py-1">Operation</th>
        <th class="border px-3 py-1">Machine</th>
        <th class="border px-3 py-1">Date</th>
        <th class="border px-3 py-1">Cost/hr</th></tr></thead><tbody>`;

      componentData.forEach(row => {
        const suitableMachines = Object.entries(row.suitable).filter(([m, v]) => v == 1);
        if (suitableMachines.length === 0) return;

        let bestMachine = null;
        let minCost = Infinity;

        suitableMachines.forEach(([machine]) => {
          const cost = Number(row.cost[machine]);
          if (cost < minCost) {
            minCost = cost;
            bestMachine = machine;
          }
        });

        const allocDate = getNextDate(startDateInput, dayOffset);
        tableHTML += `<tr>
          <td class="border px-3 py-1">${row.componentId}</td>
          <td class="border px-3 py-1">${row.operation}</td>
          <td class="border px-3 py-1">${bestMachine}</td>
          <td class="border px-3 py-1">${allocDate}</td>
          <td class="border px-3 py-1">${minCost}</td>
        </tr>`;

        dayOffset++;
      });

      tableHTML += "</tbody></table>";
      outputDiv.innerHTML += tableHTML;
    }

    fetchData();
  </script>
</body>
</html>


